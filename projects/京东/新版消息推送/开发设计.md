# 开发设计

### 标签

目前标签还未开发，需要暂时在mysql建库，一个key-value库，在前端展示标签时查mysql库即可。

其中key是标签本身，value是某个用户或者用户群，存储在mysql中的内容可以为pinList，以逗号隔开

### 素材库

素材库需要一个新的数据库，主要存储用户自己的图片、文件什么的，根据用户id去存储，存储的图片和文件可以不是地址，可以是oss的文件存储位置，然后根据oss的存储进oss查对应url再映射到前端。这样可以使数据库能存更多东西。

## 消息推送功能

根据消息类型去发送，需要三个接口：文字上传、图片上传、文件上传，可以抽象出三个方法，根据type去判断请求是什么类型，然后调用不同的方法执行。



另存为草稿接口：本质上需要在数据库添加一个字段去判断是否为草稿，在该接口中会把内容存储到数据库中，并把对应字段设置为是草稿。



获取客户信息列表接口：需要列出客户信息列表，这里目前应该是直接调用对应接口



标签列表获取接口：目前是直接查询标签数据库，后期可能开发出标签功能了就可以直接调用接口了。



## 已发送信息管理功能（根据用户ID区分不同用户消息）

根据用户token获取已发送信息列表获取(有分页) ：这个接口继承对应类，可以直接getUser使用，不过需要根据用户token去获取用户信息，现在是写死的，之后就可以根据此接口获取用户erp



根据ID获取已发送消息/草稿内容详情：这里需要根据发送消息id去获取对应详情，即某个用户发送了消息之后，需要将该消息id存储在用户表中，在查询的时候要根据用户查询用户发送的消息id，并根据此id去发送消息数据库中查询

根据ID编辑草稿信息接口同理，在查询到之后，可以将其回显前端，前端改后POST相当于又传回后端发送消息接口中。

删除草稿信息记录（软删除，该接口不支持删除已成功发送的消息记录）：此接口就说明数据库中需要添加一个软删除字段，删除就是根据此字段去改变。



## 审批流

获取指定用户发起的审批记录列表：需要用审批流的对应接口，根据user查询审批记录id



用户撤回正在审批的信息接口：本质上也是查询审批流对应接口



## 4、资源库管理

4.1、创建资源接口(只创建资源，不会调用审批和消息推送)

4.2、根据资源ID编辑已有资源信息接口

4.3、根据资源ID删除已有资源信息接口(软删除)

4.4、根据资源ID获取指定的资源详细信息



## MySQL

### 标签库

字段：String   tag   Text 	pin_list

### 素材库

字段：int id   String   user_erp     text   photo_url    text   file_url

### 用户主库

字段  int  id   text  msg    text   photo_url    text   file_url   int  ticket(存储审批返回的凭证，需要根据凭证查询审批过程)    int is_draft(是否是草稿：1:是，0：不是，默认0)    int   is_delete(是否被软删除：1：删除了   0：未删除  默认0)    int  code(审批流是否成功：1 ：成功  0：失败，默认失败)



## Redis

Redis主要存储token，用来保证幂等性，在geturl时生成一个token存到redis，以token为key，erp为value