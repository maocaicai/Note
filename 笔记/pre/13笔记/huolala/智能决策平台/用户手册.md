IDMP用户使用手册

此手册适用于智能决策管理平台（IDMP）的用户使用。                                                                                                                                                                                                                                                                                                                                                                                                                                            

| 文档编辑历史 |            |            |              |
| ------------ | ---------- | ---------- | ------------ |
| **版本**     | **日期**   | **编辑人** | **变更内容** |
| V1.0         | 2021.12.10 | 蒋元恒     | 第一版       |
|              |            |            |              |



# 一、平台介绍

## 1.1 平台简介

- 智能运营部为新成立部门，存在人力资源紧缺、历史代码积累及参考标准缺失的情况，为了更好更深入服务好HLL业务，需要从0-1搭建适配套的工程和工具以及持续迭代优化。
- 架构组承担实时补贴等多个涉及算法、模型等项目，而当前各部门间沟通成本高，操作流程长且不规范，算法、工程耦合，工作量重复。
- 为了解决上述问题，同时实现多业务接入的平台化，智能决策管理平台可以较好的满足当前需求。



# 二、快速入门

## 2.1 名词释义

| **名词概念**      | **释义**                                                     |
| ----------------- | ------------------------------------------------------------ |
| 特征              | 流量中的元数据，如请求中cityId，userId等                     |
| 规则              | 由特征及运算符组成的一系列表达式，根据表达式判断得出满足或不满足 |
| 流量管理/分流实验 | 根据特定规则对在线流量做分组的一组规则                       |
| 模型              | 算法提供的模型文件                                           |
| 策略              | 一系列规则及动作组成的逻辑结构                               |
| 任务              | 发布到接入方服务的整体结构，任务中包含分流实验、策略、模型等信息。 |

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ODEwYzJiYzAyZDhhNDVkNGJhNDdlMGM0MTJkNTQyYTZfZWdEZHFCS1ZLNGJvaE9ya0xZQ2dWRks3bTlmSzJmSW1fVG9rZW46Ym94Y25HUFBxVDg4UWVkejEwQzJCTU9SZHllXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

决策管理平台分为六个模块：

1）任务管理

用于创建发布到仿真、线上的某个接入方任务，其中包含分流实验、每个实验分组可单独配置策略、模型。同时「任务管理」可对已有任务做删除、修改、查看的操作。

2）流量管理

创建、修改、删除、查看分流实验

3）规则管理

创建、修改、删除、查看规则

4）模型管理

创建、修改、删除、查看模型

5）策略管理

创建、修改、删除、查看策略

6）特征管理

创建、修改、删除、查看特征

### 数据关系图

![image-20221128203514814](C:\Users\mao'cai'cai\AppData\Roaming\Typora\typora-user-images\image-20221128203514814.png)

## 2.2 操作流程

对于业务方的一次全流程使用操作，步骤如下：

![image-20221128203524114](C:\Users\mao'cai'cai\AppData\Roaming\Typora\typora-user-images\image-20221128203524114.png)

## 2.3 权限申请

使用决策管理平台需申请用户权限，申请地址：https://uac.huolala.work/#/app/home

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=OTY3YjE2MjU2ZjM3YThlNmRiZDQxMjE2N2JhOWQ4YmRfMUNGQ2pSdDA5T1o1cUc5MklhRXNHZlJTa0xNU3ZYVDZfVG9rZW46Ym94Y25EVFNYZFFzRUl6UHZuaFhZU3NmQTJmXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

根据需求选择相应角色

**游客**：只能查看系统中的分流实验、特征等数据

**业务方普通用户**：拥有增删改查的权限，（修改、删除权限仅限用户自己创建的数据）

**管理员**：增删改查权限（可修改、删除所有用户记录数据，不对外提供申请）

权限申请通过审批后，即可正常使用智能决策管理平台。



（使用中，如遇 「无权限」等错误提示，即UAC权限有误）

# 三、使用说明

## 3.1 特征管理

点击『特征管理』查看特征管理页面，默认展示特征列表页，是系统中所有的特征数据，根据列表页顶部的搜索功能可快速查找相应的特征。支持按照特征名称做模糊搜索，以及只列出某个服务的特征。

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=N2VkMGU0ODczNTI4NTFiNGI2MDQxM2E3ZDMzZDQ1ZDNfNGtXWDZuYTNvWVN0aktQaHVoN2djcnR0WmZQb0dlUnVfVG9rZW46Ym94Y25WZXo0Smx5OThKOVRLQ01BQ2dyYUNoXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

- 点击『添加特征』创建新的特征数据

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ODMyMDdmNGJkYjY0Yzc1ZGRkODMxOTNhMTFkNjUxYjZfM3RWalJVbGRNRFNKV1VsRWhyYTVqSVVtQzFpQW10bWVfVG9rZW46Ym94Y25NYTBmdmVWZXdrdU9hVVFodkZDMkZjXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

使用方：从下拉列表中选取该特征所属的的接入方（如 实时补贴等）

特征所属功能：已选的使用方下属的功能，如 实时补贴下包含 询价、核价、抽奖活动等功能

特征名称：自定义输入新特征的名称

使用类型：选择 输入/输出，用以标识该特征是作为输入还是输出，如cityId为流量输入，补贴率为输出

特征类型：定义特征的数据类型，现在支持int，float，string，struct，function五种类型

特征描述：自定义描述该特征，用以标识或备注



当特征类型选择struct时，也就是新建结构体特征时，需添加结构体的成员：

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=MTE3ZjQ5ZGNhZTNlYzdkYzM3MzZhMzczYmI5NGRiNDVfV3RpdWdUcnVBdDE2OVBjWVg5ZmxJVXVoOG9lWmNLaGFfVG9rZW46Ym94Y25FWnNUbUR6WHVKb3pkTVZ2VGcwMFZmXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

点击『提交』按钮，完成创建特征的操作。

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmQzZjJiYWQxYjg0Yjk1MDFlNjdhMTdhNDE2ZGY4YWFfV2tZdk9NeDJsZDlacGhOR0s5MFF1a29LMWZiUkVpTEZfVG9rZW46Ym94Y25tMlF6VFdWVW9uNE4xU3JsSHE2VjlkXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

- 对于已经创建好的特征，点击『详情』则可以查看具体特征的所有数据，点击『修改』完成修改操作，『删除』用于删除已存在的特征。

## 3.2 流量管理

点击『流量管理』进入流量管理模块，默认展示流量实验列表页

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWJlM2M3MzljZWM2MzRlZWQ0YTNhNzY4ZWUzODk5Y2RfY3VITjAyZFVJYXpRZmgxS1VqOU5pa0lET3ptamZ4bjdfVG9rZW46Ym94Y25TUVh1NVppQTkzR1VBa1dwWEtOS3VoXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

使用列表页顶部的搜索功能，可以实现根据流量实验名称模糊搜索，根据使用方筛选特定分流实验。

- 点击『添加分流实验』，创建新的分流实验

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=YTk4Yjc5OWFiODU1MGJkMjM2OTcxYTg2OTQ5M2VhODBfT0FYWGtCaGJkV3pydEplREQzRExTdW1PaXZMZENZYmZfVG9rZW46Ym94Y25mQ3JQRXVXN2RSd1FINmlOWXU1UFdnXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

使用方：从下拉列表选择分流实验所属的接入方

分流所属功能：使用方所属的某个功能

分流实验名称：自定义流量实验名称，用于唯一标识该实验

实验描述：该流量实验的描述或备注

分流实验类型：

**按规则分流**--使用系统中的规则作为分流依据，如流量满足该规则则命中该规则定义的分组；

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=NTFkMWM2ODUwNTcxNjQ4YWMwOTlkODAzMGI1ZjRjM2FfNDQzdlQwNzlNcHpnMjQxMkxlOWZ6bXJwaGJJQ2xXa1ZfVG9rZW46Ym94Y25WOXZCOTJRTGFuTkhzTEhoRG14dXJlXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

**注意**：候选实验规则只能是已经通过验证的、服务于同一个服务方、接口/功能的规则！

**按特征分流**--根据特征值取模结果（具体逻辑由接入方定义实现）作为分流依据。

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=NzZlNzE3NTUxMDhlZTFjZjFiNjQzMGRiMWI4MWIxZDBfakF6clVSWFNaeThkQlVibzlKUVhzeTFSb3dncTRCaDhfVG9rZW46Ym94Y25YVnV6Tk1oNkpPcVd4TVpCTnJpZjZkXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

**按时间片分流** -- 根据时间周期，创建分流实验

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjYyNThhY2U5Y2Q1NGI1MWFjYjcyMjhkNWE2N2FiZTdfdzQzT2RMdmdqRVFsakZZdXlZMzdmTVVQMzdNSndqdE5fVG9rZW46Ym94Y24wS1E3a3pRb09mam1LSFV0MURTcjZkXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

示例展示了时间片单位为180s创建的A、B两组实验，A组占1份（1*180s），B组占2份（2*180s），所以整个时间周期为540s，在一个周期内，流量将被分为A、B两组，比例为1:2。

**按时空分流** -- 上传区域白名单，各区域有自己的分组规则

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjAyYjdiMDBmMDQ0MzdmMTY3Mjk4ZmRmYjI1ZjRjMWVfaHVMa05QN2I0UTMzdVVEUDAzNENqdWZFcVBTU0xLYm1fVG9rZW46Ym94Y252c0tITmt5b25oT3l0RVllazFnRGFlXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

示例展示了创建两个区域的分流实验。区域“city_1012”代表请求中城市ID是1012的流量（除了城市，也可以创建H3网格、城市+网格等区域），流量分AB两组，比例是1:2，周期同上。

**按ABTest分流** -- 通过ABTest平台创建分组实验

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=OTJkMTFkMDcxYjdjMzYwMTk1NDA0NzkxMTM3MTdkNmVfbXlnNXJCRWtyb2tqbjBycGFBT1ZCakxEbVhoR0tXcTdfVG9rZW46Ym94Y251S1hZZEJTWHRyb1VZalZKY090MFNoXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=NDlkNDU3NWE5N2VmZDM0MDFlMTE4NmIyODU5OWUzZWNfZTlOUGNuV3llMmxkUkt4OVFNVEc1QTBRc3A0YjFudHRfVG9rZW46Ym94Y25xOVBVZ3poSFg4bFg5eFVmeXJldTBmXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

该分流方式集成了公司ABTest实验平台，在AB平台创建分流实验之后，可以在通过 “按ABTest分流” -> “从ABTest选择实验分组” -> “输入分层ID” -> “选择分流实验”添加。

- 在分流实验列表页，点击『修改』、『详情』和『删除』即可完成对该规则记录的修改、查看和删除操作。
- 点击『验证』对分流实验推送到仿真环境验证实验是否正确，只有验证通过的分流实验才能在任务中使用。



## 3.3 规则管理

点击『规则管理』进入规则数据列表页。使用列表顶部的搜索功能可快速查看相应规则记录，支持根据规则名称模糊搜索，根据使用方过滤数据。

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=YWU1ODAzZjA0YzZkNjBiYTc2MjJiYjdkYjk3MmE1ZTNfWVhUcExObWc5WmVZMGFxeXlqSHJVS1V1UEF2WWpZQkVfVG9rZW46Ym94Y25ma1QzVldGRXNERGdJVGZnZVJOd2pmXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

- 点击『添加规则』创建新的规则记录

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=NzhlNTVkOTIwYjkxY2RkYjlkOWZiOTJlOWQ0OGVjZmNfYkx0cWJuWVAyVWJvYlJTdEZMSWtlNzg0aGxMNk9BSjRfVG9rZW46Ym94Y25xS0pVaVRVaVBqeXFrclZ2VVR2RGpnXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

使用方：从下拉列表选择规则要应用于的服务方

规则所属接口：规则应用于服务方的某个接口功能

规则名称：新规则的自定义名称，在服务方接口功能内唯一标识某个规则

规则定义：编写自定义的规则，具体编写可参考[用户使用相关说明](https://huolala.feishu.cn/wiki/wikcn20W5kHameiZ9cSWTIPXn4b#G0E2tE) 

规则描述：自定义的规则描述或备注

点击『提交』创建新的规则。

- 在列表页点击规则记录的『修改』、『详情』和『删除』按钮可分别实现对规则的修改、查看和删除操作。
- 点击『验证』即将规则推送到仿真环境，通过仿真环境验证规则的有效性。（验证结果需主动刷新页面查看）。验证通过的规则可以用于创建分流实验等场景。

## 3.4 模型管理

点击『模型管理』进入模型列表页面。顶部搜索功能支持根据模型名称模糊搜索模型记录，根据使用方筛选模型列表。

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGM0ZjdhZDc4ZWVjZTRlN2RiYTUyOTk2YTkzZGZkMTdfOUdiZUtkVUM4Y05hT2RkR2lJZWppZlFaTXBsUXVsRUNfVG9rZW46Ym94Y25RRTZqc0lTaHhyYjVYb2s0djB3d2RlXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

- 点击『添加模型』创建新的模型记录

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=NDliYjQ5YTcwNzM4NzhkMDE1ZmI5NzQyYjRiNTQ2YjRfaU5rbTdmd2JYWkJycTVQWkpKOFJQVkw3YTJUMHA2QWNfVG9rZW46Ym94Y25ocTJzNWh5VVNmTUpVdzA3QVFGSWFnXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

使用方：从下拉列表中选择模型所属的接入服务方

模型所属接口：模型应用于服务方的某个接口/功能

模型类型：从下拉列表选择新建模型的分类

模型名称：自定义新建模型的名称，用于在某个服务、接口（功能）中唯一标识创建的模型

模型参数：（暂时可忽略此部分）

模型文件版本描述：一个模型可多次上传模型文件形成一个模型的多个版本，此项用于描述、备注当前版本

模型描述：用于描述、备注当前整个模型

上传文件：根据提示从本地上传模型文件

点击『提交』即可完成创建模型。

- 在模型列表页，点击『修改』、『详情』和『删除』即可完成对该模型记录的修改、查看和删除操作
- 点击『验证』将模型加载到仿真环境做流量验证，只有验证通过的模型才能应用在任务中。

## 3.5 策略管理

点击『策略管理』进入策略列表页面。顶部搜索功能支持根据策略名称模糊搜索策略记录，根据使用方筛选策略列表。

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTVmY2NhNmE5NmY0MmVhNWU5OTI2ZWI3NDg2NTQ5NDBfT2hSRElsQ3YzUlhuTkxCUnlRRXo4NGxEOFZkUk5sMDJfVG9rZW46Ym94Y25rT3hLZUtQWVZvaDhGVkF2RWUwM0JOXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

- 点击『添加策略』创建新的策略

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=Yzg3ZThlNWIwNWM2MWI0ZDIwNWI5MTVmMWYwNWIwMTlfRGtQUHBqUlp2MXY5cG9EcGZsSzNzQUpaUDZ1YTJoTjVfVG9rZW46Ym94Y25BOGlTR2hEM3MzNzExRVRnMkJnY1dnXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

使用方：从下拉列表选择策略要应用的接入方

策略所属接口：接入方下属的功能/接口

选择编辑或上传：支持两种方式创建策略（1-手动编辑；2-上传文件）

策略名称：自定义策略名称，唯一标识接入方、功能/接口下的该策略

策略优先级：自定义策略的优先级，以便多个策略完成顺序或并行执行（同优先级的策略同时执行，高优先级的策略先于低优先级执行）。输入范围：0 ~ int最大整数

策略定义：手动输入策略的逻辑语句，具体可参考[用户使用相关说明](https://huolala.feishu.cn/wiki/wikcn20W5kHameiZ9cSWTIPXn4b#) 

点击『提交』即可创建新策略记录

- 策略列表页，点击『修改』、『详情』和『删除』可对某条策略进行修改、查看和删除操作
- 点击『验证』对策略推送到仿真环境验证实验是否正确，只有验证通过的策略才能在任务中使用

## 3.6 任务管理

点击『任务管理』进入任务列表页。顶部搜索功能可根据任务名称模糊搜索任务记录，依据使用方筛任务列表数据。

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=YWJiYmUzMTg2NmM1OTJiYjE2NTRkMDc5N2U1Y2YwMmFfVVF1RXFOUE4yN0MzVUZ0VUoxcjNtekdGWklsV2gxZENfVG9rZW46Ym94Y25GWEpwQ05XVmptYWJIdlZDQU9kakxlXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

点击『添加任务』创建新的任务记录

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=YjE3MzAyYjEzYTE0ZmJkNGVjNDRhMmJlNDk3MTU1ZjBfVVNZOE5BU3hJWDRYSWZ0TzRJUWNOb2o2V0NxaWxMaGJfVG9rZW46Ym94Y25ESFhtV3NxZGl6YTFiVTljdFpoeUVlXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

使用方：从下拉列表中选择任务所属的接入方

任务所属接口：接入方包含的接口/功能

分流实验：从下拉列表中选择已验证通过的流量分发实验，若没有分流需求，则选择置顶项 --全流量--

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=MTk2NjFiMTc4OTg0NTcxNDc0ZmQ5NTYwNjdmYjg5OWJfTjdqaXBNQnV1aU1oT0c4bTVHMTRnc01WUHBtUzlvQjZfVG9rZW46Ym94Y251cnpuMnFTblBKTlg3d05Ud1pURlZiXzE2Njk2Mzg4ODU6MTY2OTY0MjQ4NV9WNA)

选择分流实验后，会根据所选分流实验的分组数展示如上界面。每个分组可单独配置模型（可多选）、策略（可多选）。

任务名称：自定义新建任务的名称，用于在使用方、接口/功能下唯一标识该任务记录

任务描述：描述该任务的功能等相关属性

点击『提交』即可完成任务的创建

- 任务列表页，点击『修改』、『详情』和『删除』按钮，可修改、查看和删除对应的任务记录。
- 任务列表页会展示每个任务的状态，状态集合为：**未使用、****仿真环境加载中****、****仿真环境已加载****、****线上环境加载中****、****已发布线上。**
- 任务记录可单独做『验证』和『发布』操作

**验证**：将任务推送到服务方的**仿真环境**，可以通过查看仿真环境日志观察任务中策略、模型是否符合预期。

**发布**：将任务推送到接入方的**线上环境**，只有已经发布到仿真环境的任务可以进行发布操作。



# 四、常见问题

## 问：普通用户可以修改、删除其他人创建的数据吗？

答：如果用户申请权限时选择『业务方普通用户』，只能查看其他用户的数据记录；如申请角色为『业务方管理员』则可以修改，删除其他人的数据记录。

## 问：某个任务使用了特征a，如果特征a被删除了，会影响任务吗？

答：如果任务已经进行过『验证』或『发布』操作，则该任务不受影响；如未进行『验证』，则该任务的后续操作会有错误，需重新修改。

## 问：为什么我创建的特征、规则、分流实验、策略、模型使用时没有出现在下拉列表中可供选择？

答：首先请确认之前创建的规则、特征等数据与当前记录是否属于同一个使用方和同一个功能/接口。（如，接入方实时补贴下的核价接口创建分流实验，只能使用属于实时补贴下询价接口的规则和特征）此外，规则、分流实验、模型、策略都需要验证通过后才能使用。只有完成验证操作才会出现在下拉列表数据源中。