整体方案

管理平台建设

> 🎯  构建智能运营部项目管理和算法迭代的统一管理平台。主要功能包括特征管理，策略管理，流量管理，模型管理。

# 一、项目介绍

> 智能运营业务管理平台建设是一个中长期任务，一期达成业务自动化、调参自动化、算法仿真和工程算法解耦，实现策略发布和修改的界面化和去工程化。

1. ## 名词解释

特征：特征是规则/策略创建和执行中的变量和函数的统称，和运算符一样是组成规则/策略的最小单元。

如：req.CityId, req.UserId; in() ...

规则因子：通过单个逻辑运算或函数执行组成的，可以返回true/false的一条语句。

如：

1.  if req.CityId == 1021 { //do sth… } 中，req.CityId == 1021 是经过比较运算返回true/false结果的一条语句，一个规则因子；
2. if in(req.CityId, “1011,1021”) { //do sth… } 中，in(req.CityId, “1011,1021”)是通过函数执行返回true/false结果的一条语句，也是一个规则因子；

规则：通过大于一条规则因子组合而成的，可以返回true/false结果的表达式。

如：

1.  if req.CityId == 1021 || in(req.UserId, “90021,90022”) { //do sth… }

策略：根据特定规则组合创建出的一条完整的、有返回结果的业务逻辑。

如：

1.  if req.CityId == 1021 || in(req.UserId, “90021,90022”) { 

subsidy_rate = 0.1

}

根据cityid和userid的特定规则，返回补贴率为0.1的结果。整个代码段就是一个完整的策略。

1. subsidy_rate = 0.1

这是一条不包含规则的特殊策略，即任何情况下，补贴率都为0.1。

模型：模型包含两层概念，既指经过算法训练的模型文件，又指依据某一个模型文件而实现的一套计算逻辑。

1. ## 整体架构图

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=MjdlNGM2Zjg3MGUyYzE2ODk2MzVjMWVjZDhlYTk2NGVfc09Eblk4eWRJYWJPNGxtTjlCU2NHcFNib0RweDFCNzRfVG9rZW46Ym94Y25PdVpVUmIxamJKc2ZtamNCa2s4OXhiXzE2Njk2Mzg1NjM6MTY2OTY0MjE2M19WNA)

数据流向图

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=OTdiZjQyN2NiZTcyYjkyZmNlMmVjZTM1YzY4NGVhYjBfb0FlYzVBSHAwOFRaRTQyQ1RhVkU2WFpBVmFITDFRNThfVG9rZW46Ym94Y25qeVE2SHdmMEtwTmdzZTVSZUtMSUNkXzE2Njk2Mzg1NjM6MTY2OTY0MjE2M19WNA)

1. ## 特征管理

### 3.1 特征属性（包含模型特征）

特征是规则和策略创建的基本元素，分为变量特征和函数特征两大类，变量特征既可以是自定义的单个变量也可以是一个结构体变量，设计之初应对特征的定义及属性有明确的描述，至少应包括：

- 特征ID — 特征的唯一标识。
- 特征名称 — 特征命名应尽量简明，应能通过模糊匹配快速命中。
- 特征类型 — 包括变量类型和函数类型。
- 输入/输出 — 特征属于输入参数还是输出参数。
- 特征描述 — 特征的描述信息。
- 私有属性 — 对于变量类型和函数类型的特征，各自具备的属性也不同，私有属性用来描述不同类型特征的特有属性。
  - 变量类型特征应至少具有变量类型（string、int、float…）、所属appid和接口、所属结构体（若有），成员变量和成员函数（若有）等。
  - 函数类型特征应具有参数列表及描述、返回结果列表及描述等。

### 3.2 功能描述

特征管理包括特征的创建、删除、修改、查找等基础功能。

- 创建 — 变量的创建应支持通过界面创建的单个变量和通过粘贴请求体、响应体等解析的结构体变量。函数的创建统一有后端完成，并以列表的形式返回前端展示。
- 删除 — 在没有规则和策略依赖时，可以支持删除。
- 修改 — 不支持单个变量或函数的修改，对结构体变量只支持增量修改，不支持减少结构体的成员变量和成员函数。
- 查找 — 考虑创建策略/规则是的查找和特征管理界面的查找。

1. ## 规则管理

### 4.1 规则属性

规则因子是一个/多个特征经过比较运算或函数计算后，可返回true/false结果的一条语句。规则是一个或多个规则因子经过逻辑运算组成一个可返回true/false结果的表达式。

规则有以下属性：

- 规则ID
- 规则名称
- 规则描述
- 发布状态
- 发布日期
- 创建人

### 4.2 功能描述

略。

*可参考策略管理-功能描述*

1. ## 策略管理

### 5.1 策略属性

策略是根据0个或多个规则实现的包含分支处理逻辑的业务代码段。

例如：[弹性补贴](https://huolala.feishu.cn/wiki/wikcnZbbtN04FBziavt4W785U6c) 

策略特有的属性是输出特征。除此之外，策略还有以下工程属性：

- 策略ID — 策略唯一标识。
- 策略名称 — 策略名。
- 策略优先级 — 策略优先级决定了在多个策略同时执行时的先后顺序。
- 策略描述 — 策略的详细描述。
- 所属appid和接口。
- 依赖关系 — 依赖和被依赖策略的ID。仅用于展示，方便使用者更好的了解策略的执行流程。
- 发布状态 — 是否发布。
- 发布日期 — 策略投产时间。
- 创建人 — 略。
- 修改人 — 略。

### 5.2 功能描述

策略管理除包括策略的创建、删除、修改、查找等基础功能之外，还应包括策略校验和版本控制功能。

- 创建 — 通过与界面的交互，完成策略的创建。策略中用到的输入和输出参数必须是特征管理中已经存在的特征，禁止使用未定义的临时变量和函数。
- 删除 — 策略删除应确保特征处于未使用状态。
- 修改 — 对策略的修改应做好版本控制，修改之后需要对策略的逻辑进行校验，待校验无误并发布后才能投产。
- 查找 — 应至少能根据创建人、创建日期、策略名和优先级筛选策略列表，建议支持策略内容关键字筛选策略。
- 校验 — 提供校验接口，对新建和修改的策略完成执行逻辑正确检查。
- 版本控制 — 修改已有的策略，使用版本控制，保证在未发布的状态下不能生效。

### 5.3 发布管理

策略的发布支持预发布和发布功能，预发布指的是在非生成环境的发布动作，包括dev、stg、pre和仿真环境，预发布应早于发布至少4h的时间，并通过观察策略结果感知策略的正确性。预防策略校验阶段无法检查的错误发生。

案例一：[战区复盘20210722](https://huolala.feishu.cn/docs/doccnKKDyQ2OsQUCtRA1f0ZKbjb) 

1. ## 模型管理

模型文件和模型参数绑定，当文件确定后，模型入参数量也就确定了。后台完成模型的统一管理，需要模型计算时，各业务服务调用后台服务获取获取计算结果。

### 6.1 模型文件管理

定义模型入参数量，支持模型文件的上传和测试。

### 6.2 版本管理

模型文件迭代时，需要加版本控制，发布后才可投产使用。

1. ## 流量管理

流量管理就是根据请求中的某一个或几个参数完成流量的分组，进而对各个组定义不同的执行业务逻辑。建议可以参考 [磐石分流实验的实现方式](https://stone-stg.huolala.cn/#/market-touch/money-off/create-activity?id&status=0)，先 [创建分流实验](https://stone-stg.huolala.cn/#/platform-ability/shunt-strategy/shunt-test)，然后在创建任务的时候 [选择实验](https://stone-stg.huolala.cn/#/market-touch/money-off/create-activity?id&status=0)。

### 7.1 实验属性

- 实验ID — 分流实验唯一标识。
- 实验名称
- 实验描述
- 所属业务线
- 所属appid和接口
- 发布状态 — 是否发布
- 发布日期 — 策略投产时间
- 创建人 — 略
- 修改人 — 略

### 7.2 创建实验

创建实验既可以是像“磐石平台”一样的流量百分比分组的实验，也可以是通过规则分组的实验，分别举例如下：

1. 百分比分组

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=MDRhYzI2YTJmZTQ0MDZiODhkNzMwMTIwZmI4OWZkMTRfb09FZGRZNzNGR3dIbHNBaTFKMkI2TFJQSkpDMEV3aExfVG9rZW46Ym94Y25qOXk0MUs2eHBFU2ZqbU1wWWtNNFZBXzE2Njk2Mzg1NjM6MTY2OTY0MjE2M19WNA)

1. 规则分组

配置规则表达式，然后输入分组名称。

### 7.3 修改实验

### 7.4 删除实验

1. ## 任务管理

任务管理贯穿整个管理平台使用始末，接入平台正确流程应该是先创建任务（选择业务线、appid、对应的接口等信息），然后选择流量分组，并根据分组选择策略、模型等。创建任务可参考：

![img](https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ODg0NmRmNWU4YzA0NmY2MTFiYTc4MzljYWJiNjgyMTJfbm1BNzhqQ01HY2hnSTYybnlSY3EwZXRiVU1OU3ZCajFfVG9rZW46Ym94Y25aQnk4c3NpS0YyZEg4V1ZYRUdmRjllXzE2Njk2Mzg1NjM6MTY2OTY0MjE2M19WNA)

1. ## **核心成员与项目群组**

| **核心成员**                                                 | **部门**   | **项目角色与负责事项** |
| ------------------------------------------------------------ | ---------- | ---------------------- |
| @胡报(hubao.hu) @吕泽文(zev.lv) @王帅(solomon.wang) @管宝鑫(baoxin.guan)  @蒋元恒(yuanheng.jiang) | 智能运营部 |                        |
|                                                              |            |                        |

### 7.1 **项目群组**

> 鼠标悬浮在空白行左侧，在“**+**”工具栏选择“群名片”插入群组信息

 

1. ## **背景资料**

> [智能运营业务管理平台](https://huolala.feishu.cn/wiki/wikcnbhpWq4JLek3CZIDW5C53hg) 



# 二、项目目标

> 业务自动化，调参自动化，算法仿真，工程算法解耦，限流熔断管理

**目标一：项目一期首先完成业务&调参的自动化接入，通过管理平台实现无工程介入的策略预发布和发布。**

**目标二：完成流量管理，通过管理平台实现限流&熔断规则的创建、发布和命中统计。**



# 三、月度里程碑

> 任务计划与安排将在这里明确给出，有问题可直接汇总到风险点。

⚠️ 风险点：

无法复制加载中的内容

# 四、任务拆解

## 智能决策管理平台一期

无法复制加载中的内容

# 五、项目例会

## 例会 1：整体方案及排期会 

1. ###  **会议记录** **2021/7/26 15:00**

- 特征管理需包含进入模型的特征
- 模型和策略的执行逻辑放在管理后台or业务服务
- 

1. ### 行动方案

> 创建任务列表，输入 @ 提及相关负责人，并插入截止时间

- @胡报(hubao.hu) 



# 六、项目物料汇总

文档汇总

1.  